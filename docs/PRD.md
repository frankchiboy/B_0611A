# ProjectCraft PRD

## 1. 甘特圖模組強化
### 目標與用途
- 提供即時拖曳與縮放的甘特圖介面，讓使用者迅速調整任務時程與依存關係。
- 支援多人協作，確保團隊成員同時編輯時不會互相覆蓋。

### 功能流程與操作步驟
1. 在專案儀表板開啟甘特圖。
2. 透過滑鼠拖曳任務條即可變更開始與結束日期，依存關係會即時更新。
3. 使用者可透過右鍵選單新增、刪除或複製任務。
4. 所有調整都會立刻同步至其他在線成員的畫面。

### GUI/介面互動描述
- 任務條支援拖曳與調整寬度，連結線表示依存關係。
- 透過滑鼠滾輪實現縮放，按住空白鍵拖曳則可捲動整個甘特圖視窗。

### 狀態機（狀態轉移圖）
- 狀態包含 `空閒`、`拖曳中`、`調整中`、`同步中`。
- 使用者操作時進入 `拖曳中` 或 `調整中`，完成後進入 `同步中`，待伺服器確認即回到 `空閒`。

### 資料流與 API 介面設計
- 前端透過 WebSocket 連線傳送任務變更事件至後端 `/ws/tasks/update`。
- 後端驗證並寫入資料庫後，再將更新廣播給所有連線的客戶端。
- REST API `GET /api/projects/{id}/tasks` 取得目前任務列表。

### Undo/Redo 機制
- 前端維護操作堆疊，每次變更產生一個操作記錄。
- Undo 時將最近的記錄以反向指令送出，同步到伺服器並更新其他使用者畫面。

### 快照與版本控制策略
- 每次大型變更（例如批次調整多個任務）後觸發版本快照。
- 快照存於資料庫 `project_snapshots` 表，可於版本歷史中選擇還原。

---

## 2. 資源管理視覺化增強
### 目標與用途
- 讓專案經理更清楚掌握資源分配與工作負荷，避免超額或不足。

### 功能流程與操作步驟
1. 在資源管理頁面查看所有人員或設備的負荷圖。
2. 若負荷過高，直接拖曳任務至其他資源或調整時程。
3. 所有變動即時反映在甘特圖與負荷圖上。

### GUI/介面互動描述
- 負荷圖以折線或柱狀圖呈現，每個資源都有獨立區塊。
- 當某天或某週的負荷超過上限，區域以紅色標示。

### 狀態機
- 資源處於 `正常`、`調整中` 或 `超額` 狀態。
- 調整時進入 `調整中`，更新完成後依負荷結果回到 `正常` 或 `超額`。

### 資料流與 API
- REST API `GET /api/resources` 取得資源列表與負荷資訊。
- `POST /api/tasks/{id}/assign` 調整任務指派時，回傳最新負荷資料。

### Undo/Redo
- 調整資源指派也紀錄在操作堆疊，可按 Undo 恢復。

### 快照與版本控制
- 重大資源配置調整會產生版本號，便於追蹤各次分配狀態。

---

## 3. 專案範本與快速啟動
### 目標與用途
- 提供多種預設範本，讓使用者快速建立新專案並套用既定流程。

### 功能流程與操作步驟
1. 選擇「建立新專案」時，可挑選預設或自訂範本。
2. 填入專案名稱與相關設定後，即自動生成對應的任務與資源結構。

### GUI/介面互動描述
- 範本清單以卡片形式呈現，點擊卡片可預覽主要任務結構。

### 狀態機
- 狀態包含 `選擇範本`、`編輯設定`、`建立中`、`完成`。

### 資料流與 API
- `GET /api/templates` 取得範本清單。
- `POST /api/projects` 建立新專案時傳入選定的範本 ID。

### Undo/Redo
- 在專案建立步驟中可返回上一步修改設定，直到最終確定為止。

### 快照與版本控制
- 建立完成後自動產生第一個版本快照，紀錄範本內容。

---

## 4. 通知與協同管理
### 目標與用途
- 任務或資源變更後及時通知相關成員，並支援第三方通訊整合。

### 功能流程與操作步驟
1. 任務被指派或調整時，系統立即發送通知訊息。
2. 使用者可在個人設定中選擇 Email、Slack 或 Teams 等接收方式。

### GUI/介面互動描述
- 通知面板可查看所有歷史通知，點擊後可直接跳轉對應任務。

### 狀態機
- 通知狀態分為 `未讀`、`已讀`、`已跳轉`。

### 資料流與 API
- `POST /api/notifications` 由伺服器觸發事件並存入通知表。
- 若整合 Slack/Teams，後端使用對應的 Webhook 傳送訊息。

### Undo/Redo
- 通知發送後不可撤回，但使用者操作導致的任務變更仍可透過 Undo 還原。

### 快照與版本控制
- 重大協作事件（如大量任務重排）記錄在版本快照中，方便回溯。

---

## 5. Undo/Redo 與版本管理
### 目標與用途
- 提供清楚的歷史追蹤與還原能力，避免誤操作造成損失。

### 功能流程與操作步驟
1. 每次使用者變更都產生操作記錄並存入前端堆疊。
2. 透過快捷鍵 `Ctrl+Z` 或 `Ctrl+Shift+Z` 進行復原或重做。
3. 版本快照可在專案設定頁面瀏覽並選擇還原。

### GUI/介面互動描述
- 顯示 Undo/Redo 按鈕，點擊或使用快捷鍵即可觸發。
- 版本歷史以時間軸方式呈現，每筆紀錄包含備註與時間戳。

### 狀態機
- 操作狀態切換於 `可撤銷`、`可重做` 和 `同步中`。

### 資料流與 API
- `POST /api/operations` 記錄每個操作到伺服器。
- `GET /api/projects/{id}/snapshots` 取得所有版本快照。

### Undo/Redo
- 以前端操作堆疊搭配伺服器確認機制，確保多人編輯時一致性。

### 快照與版本控制
- 快照儲存專案完整狀態，可選擇還原至任意版本；還原後仍保留還原前狀態做為新版本。

---

## 6. 效能與響應速度
### 目標與用途
- 儘可能縮短專案載入與互動等待時間，提供順暢體驗。

### 功能流程與操作步驟
1. 進入專案時先載入關鍵資料，如甘特圖與資源表。
2. 次要資料（歷史快照等）於背景載入，避免阻塞初次畫面。

### GUI/介面互動描述
- 操作應保持流暢無延遲，特別是在拖曳或縮放時。

### 狀態機
- 載入過程含 `初始化`、`載入中`、`互動中`、`背景同步`。

### 資料流與 API
- 主要 API 使用分頁與快取機制，加速傳輸。
- 即時協作走 WebSocket，減少輪詢成本。

### Undo/Redo
- 即使在大量資料時也要保持操作堆疊的輕量化，避免拖慢互動。

### 快照與版本控制
- 快照儲存採增量方式，只記錄變更部分，以降低儲存與載入負擔。


## UAT 測試
詳細測試案例請參考 [docs/UAT.md](UAT.md)。
